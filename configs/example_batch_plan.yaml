# vmware2scw Batch Migration Plan
# Generated by: vmware2scw inventory-plan --auto-map
# Review this file, then run: vmware2scw batch run --plan batch-plan.yaml

version: 1

metadata:
  generated_at: "2026-02-27T14:00:00Z"
  vcenter: vcenter.local
  total_vms: 8
  linux_vms: 5
  windows_vms: 3
  total_disk_gb: 1240

# ─── Default values (applied unless overridden per-VM) ───────────
defaults:
  zone: fr-par-1
  sizing_strategy: optimize    # exact | optimize | cost
  tags:
    - migrated-from-vmware
    - batch-2026-02
  # network_mapping:
  #   "VM Network": "vpc-prod-id"

# ─── Concurrency limits ──────────────────────────────────────────
concurrency:
  max_exports_per_host: 4       # NFC lease limit per ESXi host
  max_concurrent_conversions: 3 # Disk I/O bound
  max_concurrent_uploads: 6     # S3 bandwidth
  max_concurrent_imports: 5     # Scaleway API rate limit
  max_total_workers: 10         # Global VM parallelism

# ─── VMs to migrate ──────────────────────────────────────────────
migrations:
  # ── Canary: single VM to test the pipeline ──
  - vm_name: web-dev-01
    target_type: PLAY2-MICRO
    priority: 1
    wave: canary
    notes: "2vCPU/4GB/40GB | Ubuntu 22.04 | BIOS→UEFI needed"

  # ── Development VMs (by pattern) ──
  - vm_pattern: "dev-*"
    target_type: PLAY2-NANO
    priority: 3
    wave: dev
    tags:
      - environment:dev

  # ── Production Linux ──
  - vm_name: web-prod-01
    target_type: POP2-4C-16G
    priority: 2
    wave: production
    notes: "4vCPU/16GB/120GB | Ubuntu 20.04 | EFI"

  - vm_name: web-prod-02
    target_type: POP2-4C-16G
    priority: 2
    wave: production

  - vm_name: db-prod-01
    target_type: POP2-HM-8C-64G   # Memory-optimized for database
    priority: 2
    wave: production
    notes: "8vCPU/32GB/500GB | Debian 11 | Large data disk"

  # ── Windows VMs ──
  - vm_name: win-ad-01
    target_type: POP2-4C-16G-WIN
    priority: 4
    wave: windows
    notes: "Windows Server 2019 | AD controller | BIOS"

  - vm_name: win-app-01
    target_type: POP2-8C-32G-WIN
    priority: 4
    wave: windows

  - vm_name: win-sql-01
    target_type: POP2-HM-16C-128G  # No WIN suffix — manual type choice
    priority: 4
    wave: windows
    notes: "Windows Server 2022 | SQL Server | Large RAM needed"

# ─── VMs to exclude ──────────────────────────────────────────────
exclude:
  - vm_pattern: "template-*"
  - vm_name: legacy-do-not-touch
  - vm_regex: "^test-.*-tmp$"

# ─── Staged rollout (waves) ──────────────────────────────────────
waves:
  - name: canary
    vms: ["web-dev-01"]
    pause_after: pause              # Always pause after canary

  - name: dev
    vms: ["dev-*"]
    pause_after: pause_on_failure   # Pause only if something breaks

  - name: production
    vms: ["web-prod-*", "db-prod-*"]
    pause_after: pause              # Manual confirmation before Windows

  - name: windows
    vms: ["win-*"]
    pause_after: continue           # No pause after final wave

# ─── Post-migration actions ──────────────────────────────────────
post_migration:
  tag_source: "migrated-to-scaleway-2026-02"
  power_off_source: false     # Set to true for final cutover
  delete_vmware_snapshot: true
  delete_s3_transit: true
